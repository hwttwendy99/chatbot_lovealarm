<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聊天功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #e6f3ff 0%, #f0f0ff 30%, #fff0f7 70%, #f0fff7 100%);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .test-button {
            background: linear-gradient(135deg, #ff6b9d 0%, #c44569 50%, #f8b5d3 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 154, 173, 0.4);
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>聊天功能测试</h1>
        
        <div class="status" id="status">
            准备测试聊天功能...
        </div>
        
        <button class="test-button" onclick="testChatFunction()">
            测试聊天功能
        </button>
        
        <button class="test-button" onclick="openMainApp()">
            打开主应用
        </button>
        
        <button class="test-button" onclick="checkLoginStatus()">
            检查登录状态
        </button>
        
        <div id="results"></div>
    </div>
    
    <script>
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function testChatFunction() {
            updateStatus('正在测试聊天功能...', 'info');
            
            // 模拟登录状态
            const mockAuthManager = {
                isLoggedIn: () => true,
                currentUser: { username: 'testuser' }
            };
            
            // 模拟游戏状态
            const mockGameState = {
                unlockedCharacters: {
                    'lorenzo': true,
                    'dylan': true,
                    'nate': true,
                    'asher': true,
                    'shenzhihua': true,
                    'yangyingge': true,
                    'anyu': true,
                    'xieshuqi': true,
                    'luzeyan': true,
                    'suyan': true,
                    'wenyanzhou': true,
                    'fuye': true
                },
                dailyRemaining: 12,
                maxMessages: 10,
                currentMessageCount: 0,
                loveBellTriggered: false
            };
            
            // 模拟角色数据
            const mockCharacterData = {
                '顾景深': {
                    id: 'lorenzo',
                    name: '顾景深',
                    type: 'Dominant CEO',
                    avatar: './lorenzo-avatar.png',
                    personality: '顶层办公室的主宰者...',
                    greeting: '回来了。'
                },
                '许言': {
                    id: 'nate',
                    name: '许言',
                    type: 'Gentle Doctor',
                    avatar: './Nate-avatar.png',
                    personality: '心外科副主任...',
                    greeting: '辛苦了，来，先喝口水。'
                }
            };
            
            try {
                // 测试随机角色选择
                const characterIds = Object.keys(mockCharacterData).map(name => mockCharacterData[name].id);
                const randomIndex = Math.floor(Math.random() * characterIds.length);
                const selectedCharacterId = characterIds[randomIndex];
                const selectedCharacterName = Object.keys(mockCharacterData).find(key => 
                    mockCharacterData[key].id === selectedCharacterId
                );
                
                updateStatus(`✅ 测试成功！\n选中角色: ${selectedCharacterName}\n角色ID: ${selectedCharacterId}`, 'success');
                
                // 显示结果
                document.getElementById('results').innerHTML = `
                    <h3>测试结果:</h3>
                    <p><strong>登录状态:</strong> ${mockAuthManager.isLoggedIn() ? '已登录' : '未登录'}</p>
                    <p><strong>用户:</strong> ${mockAuthManager.currentUser.username}</p>
                    <p><strong>解锁角色数:</strong> ${Object.keys(mockGameState.unlockedCharacters).length}</p>
                    <p><strong>剩余次数:</strong> ${mockGameState.dailyRemaining}</p>
                    <p><strong>选中角色:</strong> ${selectedCharacterName}</p>
                `;
                
            } catch (error) {
                updateStatus(`❌ 测试失败: ${error.message}`, 'error');
            }
        }
        
        function openMainApp() {
            window.open('0801chatbot_副本2.html', '_blank');
        }
        
        function checkLoginStatus() {
            // 检查localStorage中的登录状态
            const currentUser = localStorage.getItem('chatbot_current_user');
            const rememberMe = localStorage.getItem('chatbot_remember_me');
            
            if (currentUser) {
                const user = JSON.parse(currentUser);
                updateStatus(`✅ 已登录\n用户: ${user.username}\n记住我: ${rememberMe === 'true' ? '是' : '否'}`, 'success');
            } else {
                updateStatus('❌ 未登录', 'error');
            }
        }
        
        // 页面加载时检查状态
        window.onload = function() {
            checkLoginStatus();
        };
    </script>
</body>
</html> 